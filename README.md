## Summary
Command line utility designed to fetch temporary CLI keys from AWS CLI use via OKTA authentication
for a currently logged in user. New key is written to aws credentials file automatically and 
lasts up to 1 hour. 

NOTE: Your credentials file will be overwritten every time, so back it up if you need to.

Please note that user must have AWS access via OKTA established
before this program can be used. To check if you have access to AWS, go to OKTA landing page and 
make sure you see AWS chiclets for the environments that you need. 

## Download Binary
Download latest version from https://repoprd.fngn.com/artifactory/simple/fe-tools/com/fngn/awsokta/
You need the version that has "-all" suffix.
Skip "Setup Project" section if you do not plan to modify code and build locally.

## Setup Project

If you wish to compile the project yourself, make sure you have JDK and gradle installed and then clone it. 
To build the project, run the following command.

```bash
# compile
gradle classes

# If everything compiles, you will need to create an executable jar for use with command line
gradle shadowJar
```

shadowJar creates an executable jar in build/libs that contains all of the dependencies inside, so no classpath 
changes are required to run the tool.
## Configuration
Optional configuration file can be provided via "-c" option. If option is not specified, program will look in 
User/<user>/.aws/ directory for file named awsokta.properties. If it does not find file there, internal configuration 
will be used.

The following properties are supported:
```bash

# okta organization URL
oktaOrgDomain=fngn.okta.com

# default environment if option -e is not provided
defaultEnv=dev

# Supported environments for -e option  
test=https://fngn.okta.com/home/amazon_aws/0oa10egxs4iIHFICKKSY/272
dev=https://fngn.okta.com/home/amazon_aws/0oa15buyl22hF0uUA1d8/272
prod=https://fngn.okta.com/home/amazon_aws/0oa10ehs498WZHWHRIAY/272
corp=https://fngn.okta.com/home/amazon_aws/0oa10ehoqciOEFROZDPT/272
finr=https://fngn.okta.com/home/amazon_aws/0oazq30wbxVIBZULVSJS/272


```

## Run the program

**NOTE:** There is a known issue with the tool, if you have pre-existing credential files with multiple profiles the program may fail. 
That is why, before running awsokta, it is recomended that you backup and remove your existing credentials file. The file can be found in your 
"user" directory (e.g. /Users/{user name}/.aws/credentials ) You do not have to manually remove credentials file generated by awsokta.

```bash
# Typical use case with a password prompt.
java -jar awsokta-1.0.2-all.jar -e dev
 
# If you have multiple roles in AWS, you can specify the one you want.
java -jar awsokta-1.0.2-all.jar -e dev -r GlobalAdmin

# If -e parameter does not support all environments you need, you can use -aws instead
java -jar awsokta-1.0.2-all.jar -aws https://fngn.okta.com/home/amazon_aws/0oa15buyl22hF0uUA1d8/272

# To see all available options, run
java -jar awsokta-1.0.2-all.jar -h
 
usage: java -jar <jar file> [-aws <URL>] [-c <CONFIG>] [-e <ENV>] [-h]
       [-org <DOMAIN_NAME>] [-p <PASSWORD>] [-r <AWSROLE>] [-s] [-u
       <USER>]
 -aws,--oktaAwsUrl <URL>              Aws url as found on OKTA page under
                                      AWS chiclet. Defaults to dev
                                      environment.
 -c,--config <CONFIG>                 Optional configuration file. By
                                      default, look in /<user>/.aws
 -e,--oktaAwsEnv <ENV>                Alternative to specifying
                                      oktaAwsUrl. Supply one:
                                      dev,test,prod,corp,finr
 -h,--help                            get usage help
 -org,--oktaOrgDomain <DOMAIN_NAME>   Domain name for OKTA organization.
                                      Defaults to fngn.okta.com.
 -p,--password <PASSWORD>             Network/Windows user password. You
                                      will be prompted for one if not
                                      supplied.
 -r,--awsRole <AWSROLE>               Specify aws role to assume in case
                                      multiple roles are available on AWS
                                      side. By default, first role in the
                                      list is assumed.
 -s,--silence                         Turn on silence mode to hide
                                      sensitive info.
 -u,--user <USER>                     Network/Windows user name. Defaults
                                      to current user.
AwsOkta. 2015 Financial Engines


 
```